<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced/docker/manual" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Manual Deployment | GATK-SV</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://broadinstitute.github.io/gatk-sv/docs/advanced/docker/manual"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Manual Deployment | GATK-SV"><meta data-rh="true" name="description" content="Build and Publish Images"><meta data-rh="true" property="og:description" content="Build and Publish Images"><link data-rh="true" rel="canonical" href="https://broadinstitute.github.io/gatk-sv/docs/advanced/docker/manual"><link data-rh="true" rel="alternate" href="https://broadinstitute.github.io/gatk-sv/docs/advanced/docker/manual" hreflang="en"><link data-rh="true" rel="alternate" href="https://broadinstitute.github.io/gatk-sv/docs/advanced/docker/manual" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FPHFCFLYVM-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Advanced Guides","item":"https://broadinstitute.github.io/gatk-sv/docs/category/advanced-guides"},{"@type":"ListItem","position":2,"name":"Docker builds","item":"https://broadinstitute.github.io/gatk-sv/docs/category/docker-builds"},{"@type":"ListItem","position":3,"name":"Manual Deployment","item":"https://broadinstitute.github.io/gatk-sv/docs/advanced/docker/manual"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9DQEYKHD1M"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9DQEYKHD1M",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="GATK-SV" href="/gatk-sv/opensearch.xml"><link rel="stylesheet" href="/gatk-sv/assets/css/styles.82e231fb.css">
<script src="/gatk-sv/assets/js/runtime~main.05c3c900.js" defer="defer"></script>
<script src="/gatk-sv/assets/js/main.efb3af0b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gatk-sv/"><b class="navbar__title text--truncate">GATK-SV</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gatk-sv/docs/intro">Documentation</a><a href="https://github.com/broadinstitute/gatk-sv/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Questions<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/broadinstitute/gatk-sv" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/intro">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatk-sv/docs/category/getting-started">Getting Started</a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/best_practices">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatk-sv/docs/category/execution">Execution</a><button aria-label="Expand sidebar category &#x27;Execution&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatk-sv/docs/category/modules">Modules</a><button aria-label="Expand sidebar category &#x27;Modules&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/runtime_attr">Runtime attributes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/resources">Resource files</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatk-sv/docs/category/troubleshooting">Troubleshooting</a><button aria-label="Expand sidebar category &#x27;Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/gatk-sv/docs/category/advanced-guides">Advanced Guides</a><button aria-label="Collapse sidebar category &#x27;Advanced Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/gatk-sv/docs/category/cromwell">Cromwell</a><button aria-label="Expand sidebar category &#x27;Cromwell&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/gatk-sv/docs/category/docker-builds">Docker builds</a><button aria-label="Collapse sidebar category &#x27;Docker builds&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/docker/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/docker/images">Docker Images Hierarchy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/docker/automated">Automated Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gatk-sv/docs/advanced/docker/manual">Manual Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/docker/dependencies">Image Dependencies</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/build_inputs">Building inputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatk-sv/docs/advanced/build_ref_panel">Building reference panels</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/acknowledgements">Acknowledgements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/gatk-sv/docs/references">Citation and references</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/gatk-sv/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/gatk-sv/docs/category/advanced-guides"><span>Advanced Guides</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/gatk-sv/docs/category/docker-builds"><span>Docker builds</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Manual Deployment</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Manual Deployment</h1></header><p>If you contribute to the GATK-SV codebase, we recommend you ensure that affected Docker images build successfully and function as intended. The process involves two steps:</p>
<ol>
<li>
<p><strong>Build</strong>: Create Docker images from Dockerfiles.</p>
</li>
<li>
<p><strong>Publish</strong>: Upload the built Docker images to container registries
(e.g., Google or Azure container registries, GCR and ACR, respectively)
to make them available for use in Terra or Cromwell.
<em>You may skip this step unless you would like to host the images you built on your own container registry.</em></p>
</li>
</ol>
<p>To streamline the process, we have developed a
<a href="https://github.com/broadinstitute/gatk-sv/blob/main/scripts/docker/build_docker.py" target="_blank" rel="noopener noreferrer">script</a>
that automates both the build and publish steps.
This section provides guidelines on setting up the environment and running the
script with a minimal example.</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>x86 Linux Machine Required</div><div class="admonitionContent_BuS1"><p>Only Linux machines (dedicated or virtual) are supported for building GATK-SV Docker images.
In addition, images created on non-Intel processor architectures (e.g., Apple M1) may not function as intended,
even if the build process runs successfully.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-an-ubuntu-vm">Setup an Ubuntu VM<a href="#setup-an-ubuntu-vm" class="hash-link" aria-label="Direct link to Setup an Ubuntu VM" title="Direct link to Setup an Ubuntu VM">​</a></h2>
<p>This section outlines steps to follow in order to
create and connect to a Linux virtual machine (VM)
on a cloud service provider.
You may <a href="#checkout">skip to the next section</a> if you are using a dedicated Linux machine
(e.g., a laptop running Ubuntu).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-set-environment-variables">1. Set environment variables<a href="#1-set-environment-variables" class="hash-link" aria-label="Direct link to 1. Set environment variables" title="Direct link to 1. Set environment variables">​</a></h4>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">GCP</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PROJECT_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;GOOGLE PROJECT ID&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">ZONE_ID</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;ZONE ID&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Make sure no machine with the following name exist,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># and you follow VM naming conventions, e.g., all lower-case characters.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INSTANCE_NAMES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;VM NAME&gt;&quot;</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-an-ubuntu-vm">2. Create an Ubuntu VM<a href="#2-create-an-ubuntu-vm" class="hash-link" aria-label="Direct link to 2. Create an Ubuntu VM" title="Direct link to 2. Create an Ubuntu VM">​</a></h4>
<p>You may <a href="#connect-to-vm">skip to the next step</a> if you have already created a VM.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">GCP</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute instances create </span><span class="token variable" style="color:#36acaa">$INSTANCE_NAMES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--project</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$PROJECT_ID</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--zone</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$ZONE_ID</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --machine-type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">e2-standard-2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --create-disk</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">auto-delete</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes,boot</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes,device-name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$INSTANCE_NAMES</span><span class="token plain">,image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">projects/ubuntu-os-cloud/global/images/ubuntu-2310-mantic-amd64-v20240213,mode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rw,size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre></div></div><p>Note that this command creates a VM with <code>100 GiB</code> disk size,
to accommodate for the disk space requirements of GATK-SV Docker images.</p><p>You may follow the documentation on
<a href="https://cloud.google.com/compute/docs/instances/create-start-instance#publicimage" target="_blank" rel="noopener noreferrer">this page</a>
for more details on creating a virtual machine on GCP.</p></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The firewall rules of your institute may require you to be on-site or connected
to the institute&#x27;s VPN before you can access the cloud resources billed to your institute.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-vm">3. Connect to the VM<a href="#connect-to-vm" class="hash-link" aria-label="Direct link to 3. Connect to the VM" title="Direct link to 3. Connect to the VM">​</a></h4>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">GCP</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$INSTANCE_NAMES</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--project</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$PROJECT_ID</span><br></span></code></pre></div></div><p>Follow the on-screen prompts for authorizing access to <code>ssh</code> credentials.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Errors running this command</summary><div><div class="collapsibleContent_i85q"><div><p>If you are getting any of the following error messages when you try
to connect to the VM immediately after you have created it,
it may indicate that the VM is not ready yet, and you may need to
wait a few minutes before retrying.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh: connect to </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">IP address</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">22</span><span class="token plain">: Connection refused</span><br></span></code></pre></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ERROR: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gcloud.compute.ssh</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/usr/bin/ssh</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> exited with </span><span class="token builtin class-name">return</span><span class="token plain"> code </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">username@</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">IP address</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: Permission denied </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">publickey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.</span><br></span></code></pre></div></div></div></div></div></details></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="docker">4. Install Docker<a href="#docker" class="hash-link" aria-label="Direct link to 4. Install Docker" title="Direct link to 4. Install Docker">​</a></h4>
<p>You may <a href="#checkout">skip to the next step</a> if you have already installed and configured Docker on this VM.</p>
<ol>
<li>
<p>Install pre-requisites</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ca-certificates </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> 0755 </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> /etc/apt/keyrings </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-fsSL</span><span class="token plain"> https://download.docker.com/linux/ubuntu/gpg </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> /etc/apt/keyrings/docker.asc </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> a+r /etc/apt/keyrings/docker.asc </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;deb [arch=</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">dpkg --print-architecture</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">.</span><span class="token string variable" style="color:#36acaa"> /etc/os-release </span><span class="token string variable operator" style="color:#393A34">&amp;&amp;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$VERSION_CODENAME</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> stable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/apt/sources.list.d/docker.list </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span></code></pre></div></div>
</li>
<li>
<p>Install Docker</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-aG</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">USER</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newgrp </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre></div></div>
<p>You may follow <a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noopener noreferrer">Docker documentation</a>
on details on installed Docker on Ubuntu.</p>
</li>
<li>
<p>Login to Docker</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">GCP</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>
<p>Run the following command on the VM.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth login</span><br></span></code></pre></div></div>
</li>
<li>
<p>Follow the on-screen prompts, it will display a URL that you need to copy-paste it
on the browser of your computer (<em>not</em> the VM).</p>
</li>
<li>
<p>Follow the prompts on your browser, and login with an account that will provide you
with access to the GCR repository. If you are planning on <em>publishing</em> images you
build to GCR, you need to make sure you account has <a href="https://cloud.google.com/artifact-registry/docs/docker/pushing-and-pulling#required_roles" target="_blank" rel="noopener noreferrer">sufficient access</a>
to GCR.</p>
</li>
<li>
<p>Configure Docker with your credentials.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth configure-docker</span><br></span></code></pre></div></div>
</li>
</ul><p>You may refer to <a href="https://cloud.google.com/artifact-registry/docs/docker/authentication" target="_blank" rel="noopener noreferrer">this page</a>
for more details on configure Docker to access GCR.</p></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="checkout">Checkout codebase<a href="#checkout" class="hash-link" aria-label="Direct link to Checkout codebase" title="Direct link to Checkout codebase">​</a></h2>
<ol>
<li>
<p>Clone the repository or its fork that contains the branch with the changes
that you want to build the Docker images based-off.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/broadinstitute/gatk-sv </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> gatk-sv</span><br></span></code></pre></div></div>
</li>
<li>
<p>Checkout the branch containing your changes.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BRANCH_NAME</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build">Build and Publish Docker Images<a href="#build" class="hash-link" aria-label="Direct link to Build and Publish Docker Images" title="Direct link to Build and Publish Docker Images">​</a></h2>
<p>In its minimal setup, you may use the following command to <strong>build and publish</strong> GATK-SV Docker images.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 scripts/docker/build_docker.py </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--targets</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">IMAGES</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-tag </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">TAG</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --docker-repo </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">CONTAINER_REGISTRY</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>The arguments are explained in the following.</p>
<ul>
<li><a href="#targets"><code>--targets</code></a></li>
<li><a href="#tag"><code>--image-tag</code></a></li>
<li><a href="#registry"><code>--docker-repo</code></a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="targets"><code>--targets</code><a href="#targets" class="hash-link" aria-label="Direct link to targets" title="Direct link to targets">​</a></h3>
<p>You may follow either of the following approaches to determine which images to rebuild.</p>
<ul>
<li>
<p><strong>Manual:</strong>
You may refer to the table in <a href="/gatk-sv/docs/advanced/docker/dependencies#list">this section</a>
to determine which Docker images to rebuild based on the changed files.
For instance, if you modified any of the files under the
<a href="https://github.com/broadinstitute/gatk-sv/tree/main/src/svtk" target="_blank" rel="noopener noreferrer"><code>gatk-sv/src/svtk/</code></a>
directory, you will need to rebuild the <code>sv-pipeline</code> Docker image.
You can set the list of images to rebuild using the <code>--targets</code> argument.
For instance:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python scripts/docker/build_docker.py </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--targets</span><span class="token plain"> sv-pipeline</span><br></span></code></pre></div></div>
<p>You may specify multiple images to rebuild by providing a list of their names.
For instance, the following command builds the <code>sv-pipeline</code> and the <code>str</code> Docker images.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python scripts/docker/build_docker.py </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token parameter variable" style="color:#36acaa">--targets</span><span class="token plain"> sv-pipeline str</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Automatic (advanced):</strong>
You may refer to <a href="/gatk-sv/docs/advanced/docker/images#incremental">this page</a> for details on this method.
Briefly, you may take the following steps.</p>
<ol>
<li>
<p><code>git commit</code> the changes.</p>
</li>
<li>
<p>Identify <code>BASE_SHA</code> and <code>HEAD_SHA</code> using <code>git log</code> or GitHub.
You may use the following commands to get these SHAs.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">HEAD_SHA</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">git</span><span class="token variable" style="color:#36acaa"> log </span><span class="token variable parameter variable" style="color:#36acaa">-1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">--pretty</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">format:</span><span class="token variable string" style="color:#e3116c">&quot;%H&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">BASE_SHA</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">git</span><span class="token variable" style="color:#36acaa"> merge-base main </span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">git branch --show-current</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre></div></div>
<p>Note that, you may need to <a href="https://git-scm.com/docs/git-merge-base" target="_blank" rel="noopener noreferrer">modify these commands</a> if your branch has a complicated git history.</p>
</li>
<li>
<p>Run the script using <code>--base-git-commit</code> and <code>--current-git-commit</code> instead of <code>--targets</code>.</p>
</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python scripts/docker/build_docker.py </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --base-git-commit </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BASE_SHA</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --current-git-commit </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">HEAD_SHA</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
</li>
</ul>
<p>Please note that <code>--targets</code> and <code>--base-git-commit --current-git-commit</code>
options are mutually exclusive. In other words, you can either manually specify
images to rebuild, or let the script determine them automatically using commit SHAs;
combining or avoiding both options is not currently supported.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Following the steps above, the script builds the specified Docker images
<em>and all the images derived from them</em>.
You may add the <code>--skip-dependent-images</code> flag to build only the explicitly specified images.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tag"><code>--image-tag</code><a href="#tag" class="hash-link" aria-label="Direct link to tag" title="Direct link to tag">​</a></h3>
<p>You may use any naming convention for the Docker image
<a href="https://docs.docker.com/engine/reference/commandline/tag/" target="_blank" rel="noopener noreferrer">tags</a>.
GATK-SV Docker images are tagged using the following template
(you may refer to <a href="/gatk-sv/docs/advanced/docker/automated#args">this section</a> for details).</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Date]-[Release Tag]-[Head SHA 8]</span><br></span></code></pre></div></div>
<p>For example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--image-tag 2023-07-28-v0.28.1-beta-e70dfbd7</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="registry"><code> --docker-repo</code><a href="#registry" class="hash-link" aria-label="Direct link to registry" title="Direct link to registry">​</a></h3>
<p>If you are only testing GATK-SV Docker image build,
you may skip this section and avoid providing <code>--docker-repo &lt;registry&gt;</code>.
However, if you need to push image to container registries,
need images for WDL testing, or need to host the images on a container registry
other than those maintained by the GATK-SV team.</p>
<p>The <code>build_docker.py</code> script automatically pushes Docker images to a container registry
when <code>--docker-repo &lt;registry&gt;</code> is provided, replacing <code>&lt;registry&gt;</code> with the container registry you want to use.
When providing this argument, ensure that you are logged into Docker with
credentials granting push access to the registry,
You may configure and set the registry as the following.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">ACR</li><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">GCR</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6" hidden=""><ul>
<li>
<p>You may follow <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli" target="_blank" rel="noopener noreferrer">these steps</a>
if you have not configured a container registry.</p>
</li>
<li>
<p>Once configured, you may set <code>&lt;registry&gt;</code> in the following template.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">REGISTRY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.azurecr.io/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">REPOSITORY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">IMAGE</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">myregistry.azurecr.io/gatk-sv</span><br></span></code></pre></div></div>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6"><ul>
<li>
<p>You may follow <a href="https://cloud.google.com/artifact-registry/docs/repositories/create-repos" target="_blank" rel="noopener noreferrer">these steps</a>
if you have not configured a container registry.</p>
</li>
<li>
<p>Once configured, you may set <code>&lt;registry&gt;</code> in the following template.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">HOST_NAME</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">REPOSITORY</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">IMAGE</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">us.gcr.io/my-repository/gatk-sv</span><br></span></code></pre></div></div>
</li>
</ul></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="post-build">Post-build<a href="#post-build" class="hash-link" aria-label="Direct link to Post-build" title="Direct link to Post-build">​</a></h2>
<ul>
<li>
<p>GATK-SV docker images are mainly intended for use in WDLs.
Therefore, it&#x27;s a good practice to run the related WDLs with
updated images to assert if the images function as expected.</p>
</li>
<li>
<p>If you were using a Linux VM to build the Docker images,
ensure you either stop or delete the VM after building the images.
Stopping the VM won&#x27;t delete the disk, and you may continue to
incur disk usage charges. If you plan on re-using the VM,
stopping is preferred as it preserves the configuration;
otherwise, you may delete the VM and all the associated resources
(attached disks in particular).</p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/broadinstitute/gatk-sv/tree/master/website/docs/advanced/docker/manual.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/gatk-sv/docs/advanced/docker/automated"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Automated Deployment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/gatk-sv/docs/advanced/docker/dependencies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Image Dependencies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup-an-ubuntu-vm" class="table-of-contents__link toc-highlight">Setup an Ubuntu VM</a></li><li><a href="#checkout" class="table-of-contents__link toc-highlight">Checkout codebase</a></li><li><a href="#build" class="table-of-contents__link toc-highlight">Build and Publish Docker Images</a><ul><li><a href="#targets" class="table-of-contents__link toc-highlight"><code>--targets</code></a></li><li><a href="#tag" class="table-of-contents__link toc-highlight"><code>--image-tag</code></a></li><li><a href="#registry" class="table-of-contents__link toc-highlight"><code> --docker-repo</code></a></li></ul></li><li><a href="#post-build" class="table-of-contents__link toc-highlight">Post-build</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/gatk-sv/docs/intro">About</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/broadinstitute/gatk-sv/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://talkowski.mgh.harvard.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Talkowski lab</a></li><li class="footer__item"><a href="https://www.broadinstitute.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Broad Institute</a></li><li class="footer__item"><a href="https://www.massgeneral.org/research/cgm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Center for Genomic Medicine</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 BroadInstitute, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>